pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--init

function _init()
 
 music()
 	
	x=0
 y=8
 f=17

 bombs={}
 flames={}
 enemies={}
 
end
-->8
--update

function _update()

 if btn(0) and not collide(x-1,y) then
  x-=1
  f+=0.25
 end
 if btn(1) and not collide(x+1,y) then
  x+=1
  f+=0.25
 end
 if btn(2) and not collide(x,y-1) then
  y-=1
  f+=0.25
 end
 if btn(3) and not collide(x,y+1) then
  y+=1
  f+=0.25
 end
 if btn(4) then
  new_bomb(x,y)
 end
 
 if (f > 18) f=17
 
 for bomb in all(bombs) do
 	bomb.timer+=1
 	if bomb.timer > 55 then 	 
 	 local x=bomb.x
 	 local y=bomb.y
 	 new_flame(x-8,y)
 	 new_flame(x,y)
 	 new_flame(x+8,y)
 	 new_flame(x,y-8)
 	 new_flame(x,y+8)
 	 
 	 sfx(1)
 	
 	 del(bombs,bomb)
 	end
 end
 
 for flame in all(flames) do
 	flame.timer+=1
 	if flame.timer > 15 then 	 
 	 local cx=c(flame.x)
 	 local cy=c(flame.y)
 	 if mget(cx,cy) == 3 then
 	  mset(cx,cy,1)
 	 end
 	 del(flames,flame)
 	end
 end
 
 if #enemies == 0 then
  add_enemy(40)
 end
 for e in all(enemies) do
  e.x-=0.1
  e.t+=1
  e.y=30+sin(e.t/200)*10
  if e.x < -5 then
   del(enemies, e)
  end
 end
 
end

-->8
--draw

function _draw()

 cls()
 map()
 
 for bomb in all(bombs) do
  if bomb.timer > 30 then
  	spr(8,bomb.x,bomb.y)
  else
   spr(7,bomb.x,bomb.y)
  end
 end

	for flame in all(flames) do
  spr(11,flame.x,flame.y)
 end
 
 --player
 spr(f,x,y)
 
 for e in all(enemies) do
  spr(10,e.x,e.y)
 end
  
 collide(7,7)
 print(#bombs)
end
-->8
--stuff

function new_flame(x,y)
	local f={}
 f.x=x
 f.y=y
 f.timer=0
 add(flames, f) 
end

function add_enemy(y)
	local e={}
 e.x=128
 e.y=y
 e.t=0
 add(enemies, e) 
end

function new_bomb(x,y)
 local bx=x+3
 local by=y+4
 local x=bx-(bx%8)
 local y=by-(by%8)
 local f=false
 for b in all(bombs) do
  if b.x==x and b.y==y then
   f=true
  end
 end
 
 if #bombs < 2 and not f then
  local b = {}
  b.x=x
  b.y=y
  b.timer=0
  sfx(0)
 	add(bombs, b) 
 end
end

function c(v)
 return flr(v/8)
end

function collide(x,y)
 local a = collide_corner(x,y)
 local b = collide_corner(x+5,y)
 local c = collide_corner(x+5,y+7)
 local d = collide_corner(x,y+7)
 return a or b or c or d
end

function collide_corner(x,y)
 return fget(mget(c(x),c(y)), 0)
end


__gfx__
00000000444444444499994444bbbb44111111111cc1cc1c07770000000000000000000047777774000000000079970000000000000000000000000000000000
0000000044444444499994444b33333411111111cccccccc7777770000070000000f000079999995000700000794497000000000000000000000000000000000
007007004444454499999999b33bbb311111c1111111111177ccc00000c7c00000efe000799119950007c0007947749700000000000000000000000000000000
000770004444444499999999b3b333311111111111111111077770000c575c000e5f5e00791991950077cc009479974900000000000000000000000000000000
000770004444444494499999b3b3313111111111c1cc1cc105cc000077757770fff5fff0791991950077cc009479974900000000000000000000000000000000
007007004544444494449999b33313311c111c11cccccccc05cc00000c575c000e5f5e007991199507cc77c09479974900000000000000000000000000000000
0000000044444444999994994333333411111111111111110570700000c7c00000efe000799999950ccccc700997799000000000000000000000000000000000
0000000044445444999994994411114411c11111111111110070700000070000000f000045555554005555000077770000000000000000000000000000000000
00000000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077ccc0007777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000777700077ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000005cc00000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000005cc000005cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000057070000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020205020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103030404010103010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103030404010103010101020202010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030101010103010101030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010103010103020101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103010103010103020201030103030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103010103010103020201030103010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103010103010103020209030103010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200002911026110231101f1101a110211001810018100181000110001100011000110001100011000110001100000000000000000000000000000000000000000000000000000000000000000000000000000
000200000b5200d5400a5600c5600c540095200d520065200d5200f520095100d510075100d5000b5000b5001b2001b2001b2001b200000000000000000000000000000000000000000000000000000000000000
011e0000180501a0501b0501d050170001f050000001b0501a05018050000000000000000000001d050000001b050000001a05018050160501805000000000000000011050000000f050000000e0500c05000000
011e0000180230c000180230c000180230c0001802300000150230000015023000001502300000150230000017023000001702300000170230000017023000001802300000180230000018023000001802300000
011e0000180501a0501b0501d050170001f05000000240501f0501d0501b0501805000000000001d0501b0501d0501b0501a05018050160501805000000000000000011050000000f050000000e0500c05000000
__music__
01 02034344
02 04034344

