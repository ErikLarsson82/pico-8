pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
dunes={}
dust={}
x=20
y=60
c=0
turbo=10
t=false
air_resistance=0.94
started=false

function add_dune(x,y)
  local dune={}
  dune.x=x
  dune.y=y
  
  add(dunes, dune)
end

function add_dust(x,y)
  local d={}
  d.x=x+3
  d.y=y+4
  d.vx=0-rnd(2)
  d.vy=0.5-rnd(1)
  d.t=0
  
  add(dust,d)
end

function _init()
 sfx(3)
 music()
 add_dune(50,50)
 add_dune(90,30)
 add_dune(40,110)
end

function _update()
 c+=1
 
 if c % 5 == 0 then
  sfx(0)
 end
 
 for dune in all(dunes) do
  dune.x -= 1
  if dune.x < -8 then
   dune.x = 128
  end
 end
 
 for d in all(dust) do
  d.vx=d.vx*air_resistance
  d.vy=d.vy*air_resistance
  d.x+=d.vx
  d.y+=d.vy
  d.t+=1
  if d.t > 5 then
   del(dust, d)
  end
 end
 
 add_dust(x,y)
 
 if not started then
  if btn(5) then
   started=true
  end
  return
 end
 
 if btn(5) and turbo > 2 then
  t=true
  turbo-=1
  sfx(2)
 else
  t=false
  turbo+=0.3
 end
 
 turbo=mid(0,turbo, 24)
 
 local s=1
 
 if t then s=3 end
 
 if (btn(0)) x-=s
 if (btn(1)) x+=s
 if (btn(2)) y-=s
 if (btn(3)) y+=s
 
 x=mid(5,x,105)
 y=mid(30,y,115)
end

function _draw()
	palt(13, false)
 palt(0, true)
 cls(9)
 
 --background
 rectfill(0,0,129,22,12)
 
 function lx(v)
  return (c/v)%128
 end
 local x1=0-lx(8)+128
 local x2=0-lx(8)
 local x3=0-lx(4)+128
 local x4=0-lx(4)
 local x5=0-lx(2)+128
 local x6=0-lx(2)
 
 map(32,0,x1,0,16,3)
 map(32,0,x2,0,16,3)
  
 map(16,0,x3,0,16,3)
 map(16,0,x4,0,16,3)
 
 map(0,0,x5,0,16,3)
 map(0,0,x6,0,16,3)
 
 
 for dune in all(dunes) do
  spr(2, dune.x, dune.y)
 end
 
 --mad max car
 spr(4,x,y+(sin(c/5)*0.2),2.0,1.0)
 
 --boss car
 --palt(13, true)
 --palt(0, false)
 --spr(6,50,50,3.0,3.0)
 
 for d in all(dust) do
  local pc=4
  if t then pc=8 end
  pset(d.x,d.y,pc)
 end
 
 if not started then
  spr(64,33,30,7,2)
  rectfill(0,70,128,76,0)
  print("press ❎ to start",30,71,7)
 end
 
 rectfill(0,119,128,140,0)
 
 print("fuel:",1,122,7)
 rect(22,120,50,127,7)
 rectfill(24,122,34,125,11)
  
 local d=77
 print("nitro:",74,122,7)
 rect(22+d,120,50+d,127,7)
 rectfill(24+d,122,24+d+turbo,125,8)
end
__gfx__
000000009999999900000000000000000001555555000000880dddddfdedfddddddddddddddddddd000000000000000220000000000000000000000044444444
000000009999999900000000000000000015555777701100880ddddddfffdddddddddddddddddddd000000000000002222000000000000000000000044444444
007007009999999900000000000000000055555555555550ddd0d555ddfddddddddddddddddddddd000000000000022222200000000000000000000044444444
000770009999999900000000000000000055115555511550ddd0d5555555dddddddddddddddddddd000000000000222222220000000000000000000044444444
0007700099999999000000000555cc000000110000011000ddd0d5555555ccccdddddddddddddddd004444000002222222222000000000000000000044444444
007007009999999900444400555555550000000000000000dddd011155550cccc5dddddddddddddd044444400022222222222200002222222222220044444444
000000009999999944000044515555150000000000000000dddd55511115c00cc5dddddddddddddd444444440222222222222220022222222222222044444444
000000009999999900000000111551110000000000000000dddd5555551111cc55dddddddddddddd444444442222222222222222222222222222222244444444
000000000000000044000000000000000000000000000000dddd55555555cc11105555d11d11dddd000000002222222200000000000000000000000044444444
000000000000004400000000000000000000000000000000ddddddd555555ccc55501501515155dd000000002222222200000000000000000000000044444444
000000000004440000000000000000000000000000000000ddddd11ddddd555555551501010105dd000000002222222200000000000000000000000044444444
000000004440000000000000000000000000000000000000ddd11111ddddddd557001501515155dd077000002222222200000000000000000000000044444444
000004440000000000000000000000000000000000000000ddd111111ddddddd7707d555555005dd777700002222222200000000000000000000000044444444
004440000000000000000000000000000000000000000000ddd111111ddddd777077ddd1115555dd077000002222222200000000000000000000000044444444
440000000000000000000000000000000000000000000000dddd1111ddddd77dd77dddd111dddddd000000002222222200000000000000000000000044444444
000000000000000000000000000000000000000000000000ddddd11ddddddddd77ddddd111dddddd000000002222222200000000000000000000000044444444
000000000000000000000000000000000000000000000000dddddddddddddddd7ddddddddddddddd007777000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd077777777000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd777777777700000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd777777777700770000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd777777777777777000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd077777777777777000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000
77777777777777777777777777777777777777777777777777777777000000000000000000000000000000000000000000000000000000000000000000000000
75555555555555555555555555555555555555555555555555555556000000000000000000000000000000000000000000000000000000000000000000000000
7599555559a5555a5555aa9555555511555554455554555599559956000000000000000000000000000000000000000000000000000000000000000000000000
7599a555a9a5555a5555a99955555545955599955554555599559956000000000000000000000000000000000000000000000000000000000000000000000000
7549aa5aa9a55599a555a9999555554599599a955554555554aa5556000000000000000000000000000000000000000000000000000000000000000000000000
75499aaa99955599a555a919545555159999a1955559555554aa5556000000000000000000000000000000000000000000000000000000000000000000000000
754999a999955599a555a91954555599999a51955599955554aa5556000000000000000000000000000000000000000000000000000000000000000000000000
75499999999554915955991954555599999911955991995555995556000000000000000000000000000000000000000000000000000000000000000000000000
75999999559554915955991954555599999999955991a95555995556000000000000000000000000000000000000000000000000000000000000000000000000
75999595a5955491595599195a555599a59599a55991a95555994556000000000000000000000000000000000000000000000000000000000000000000000000
75999555a595599559559919aa5555a9a55599a55999995555994556000000000000000000000000000000000000000000000000000000000000000000000000
75a99555a59599999995a99a495555a9a55599a54999a9a559999456000000000000000000000000000000000000000000000000000000000000000000000000
75a99555999599a59495a444955555aaa55599a5488599959a55a456000000000000000000000000000000000000000000000000000000000000000000000000
75a99555aa95aaa59995aa995555559995559aa54485a9a59a55a456000000000000000000000000000000000000000000000000000000000000000000000000
75555555555555555555555555555555555555555555555555555556000000000000000000000000000000000000000000000000000000000000000000000000
76666666666666666666666666666666666666666666666666666666000000000000000000000000000000000000000000000000000000000000000000000000
__map__
000000000000000000000000000000000000000d0e0000000000000000000000001a002a2b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000b1b1b0c00000d0e0000000000000000000000000000001a002a2b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a000a00000a0a0a00000a0a000a0a000b1b1b1b1b0c0b1b1b0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000300003010030200300002000020100301003010030100201002000020000200002000020000301003010000000000000000000000000000000000000000000000000000000000000000000000000000
00070000030500405006050080500b0500e050100501405019050220502405014000180001a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000500000c6100c6100c6100c6100c6101e5101f5101f5101e5101c5101b510166101661016610166100e4000d40014300133001d1001d1001d1001d1001c1000000000000000000000000000000000000000000
011700001805518055180551805518055180551805518055170551705517055170551505515055150551505518055180551805518055180551805518055180551705517055170551705515055150551505515055
010100000b1170e1170f12710127111271213712137121471214712147121471213711127101270d1170a10306103041030000000000000000000000000000000000000000000000000000000000000000000000
01060000080520b0520b0520b05209052050520a0000a0000a0000900008000050000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01170000181101811218112181121811218112181121811218110181121811218112181121811218112181121a1101a1121a1121a1121a1121a1121a1121a1121a1101a1121a1121a1121a1121a1121a1121a112
011700001c1101c1121c1121c1121c1121c1121c1121c1121c1101c1121c1121c1121c1121c1121c1121c1121f1101f1121f1121f1121f1121f1121f1121f1121f1101f1121f1121f1121f1121f1121f1121f112
0117000018055180551805518055180551805518055180551f0551f0551f0551f055200552005520055200551b0551b0551b0551b0551b0551b0551b0551b0551f0551f0551f0551f05520055200552005520055
01170000181101811218112181121811218112181121811218110181121811218112181121811218112181121a110181121811218112181121811218112181121811018112181121811218112181121a1121b112
01170000180551805518055180551705517055170551705518055180551805518055170551705517055170551f0551f0551f0551f0551f0551f0551f0551f0552005520055200552005520055200552005520055
0117000018110181121811218112181121811218112181121a1101a1121a1121a1121a1121a1121a1121a11218110181121811218112181121811218112181121a1101a1111a1111a1111a1111a1111a1111a111
01170000080220b0220b0220b03209042050521c61100000080220b0220b0220b03209042050521c61100000080220b0220b0220b03209042050521c61100000080220b0220b0220b03209042050521c61100000
011700002411024112241122411224112241122411224112261102611226112261122611226112261122611224110241122411224112241122411224112241122611026112261122611226112261122611226112
__music__
01 03050644
00 03050744
00 08050944
00 0a050b44
00 080c060d
02 080c060d
02 434c4944

