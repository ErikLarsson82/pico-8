pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--init

function _init()
 
 m=0
 
	p1_x=16
 p1_y=16
 p1_bx=0
 p1_by=0
 p1_f=0
 
 p2_x=32
 p2_y=32
 
 han=0
 cooldown=0

end
-->8
--update

function _update()

 p1_f+=0.3
 if p1_f>2 then
  p1_f=0
 end
 
	if p1_bx==3 then
		if not collide(p1_x+1,p1_y,0) then
		 p1_x+=1
		else
 		p1_bx=0
 	end
 	
		if not collide(p1_x+1,p1_y,0) then
		 p1_x+=1
		else
 		p1_bx=0
 	end

		if not collide(p1_x+1,p1_y,0) then
		 p1_x+=1
		else
 		p1_bx=0
 	end

 else
  if btn(0) and not collide(p1_x-1,p1_y,0) then
   p1_x-=1
  end
  if btn(1) and not collide(p1_x+1,p1_y,0) then
   p1_x+=1
  end
  if btn(2) and not collide(p1_x,p1_y-1,0) then
   p1_y-=1
  end
  if btn(3) and not collide(p1_x,p1_y+1,0) then
   p1_y+=1
  end
 end
 
 if collide(p1_x,p1_y,1) and han==0 then
 	m+=1
 	
 	if m>2 then
 	 m=0
 	end
 	
 end
 
 if btn(4) then
 	p1_bx=3
 end
 
 local collision = collide_player(p1_x,p1_y,p2_x,p2_y)
 local iscooling = cooldown != 0

 if collision and not iscooling then
  sfx(0)
  cooldown=30
  if han==0 then
   han=1
  else
   han=0
  end
 end
 
 if cooldown > 0 then
 	cooldown-=1
 end
end
-->8
--draw

function _draw()
 cls(1)
 map(m*16)
	spr(16+p1_f,p1_x,p1_y)
	if han==0 then
	 if cooldown==0 then
	  spr(4,p1_x,p1_y)
	 else
	  spr(5,p1_x,p1_y)
	 end
	end
	spr(3,p2_x,p2_y)
	if han==1 then
	 if cooldown==0 then
	  spr(4,p2_x,p2_y)
	 else
   spr(5,p2_x,p2_y)	  
  end
	end
end
-->8
--collisions

function c(v)
 return flr(v/8)
end

function collide(x,y,t)
 local a = collide_corner(x,y,t)
 local b = collide_corner(x+7,y,t)
 local c = collide_corner(x+7,y+7,t)
 local d = collide_corner(x,y+7,t)
 return a or b or c or d
end

function collide_corner(x,y,t)
 local a = c(x)+(m*16)
 local b = c(y)
  
 return fget(mget(a,b),t)
end

function collide_player(p1_x,p1_y,p2_x,p2_y)
 local a = p1_x+8>p2_x
 local b = p1_x<p2_x+8
	local c = p1_y+8>p2_y
 local d = p1_y<p2_y+8 
 return a and b and c and d
end

__gfx__
00000000aaaaaaaa4444444477777777080000800c0000c000000000dddddddd0000000000000000000000000000000000000000000000000000000000000000
00000000a00ee00a455555547002200780000008c000000c000bb000d222222d0000000000000000000000000000000000000000000000000000000000000000
00700700a0eeee0a4555555470222207000000000000000000333300d222222d0000000000000000000000000000000000000000000000000000000000000000
00077000aeeeeeea455555547222222700000000000000000b3003b0d222222d0000000000000000000000000000000000000000000000000000000000000000
00077000aeeeeeea455555547222222700000000000000000b3003b0d222222d0000000000000000000000000000000000000000000000000000000000000000
00700700a0eeee0a4555555470222207000000000000000000333300d222222d0000000000000000000000000000000000000000000000000000000000000000
00000000a00ee00a455555547002200780000008c000000c000bb000d222222d0000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa4444444477777777080000800c0000c000000000dddddddd0000000000000000000000000000000000000000000000000000000000000000
000ccc00000ccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c6c00006c6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006000000660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666660000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006000000060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006000006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00060600006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00060600006006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020202020202020202020202020202020202070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000006000000000000000000000002070600000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000020202020200000202000000020202020202020000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200060000000000000000000000000202000000000002000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000020000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000020000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000200000000000000000202000000020000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000200000000000000000202000000020000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000200000000000000000202000000020202020200000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000202020202020000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000202000000000000000000000000000002070000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000014010150101701018010190101b0101d0101f010210102301021010180101201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
